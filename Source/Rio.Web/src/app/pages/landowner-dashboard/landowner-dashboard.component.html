<div class="container mt-sm-4" *ngIf="user">
  <h2 style="display: inline-block">
    Landowner Dashboard - {{user.FullName}}
  </h2>
  <app-alert-display></app-alert-display>

  <div class="mt-2" *ngIf="getPendingTrades().length > 0">
    <div class="alert alert-info" style="max-height: 160px; overflow: auto;">
      <ul>
        <li *ngFor="let pendingTrade of getPendingTrades()">
          <span *ngIf="doesMostRecentOfferBelongToCurrentUser(pendingTrade)">
            You have submitted an offer to {{getPendingTradePostingType(pendingTrade)}} water. The
            {{getRespondeeType(pendingTrade, true)}} has {{getDaysLeftToRespond(pendingTrade)}} days to respond.
            <a routerLink="/trades/{{pendingTrade.TradeID}}">[View offer details]</a>
          </span>
          <span *ngIf="!doesMostRecentOfferBelongToCurrentUser(pendingTrade)">
            A {{getRespondeeType(pendingTrade, false)}} is awaiting your response to their offer. This offer expires in
            {{getDaysLeftToRespond(pendingTrade)}} days.
            <a routerLink="/trades/{{pendingTrade.TradeID}}">[Respond to this offer]</a>
          </span>
        </li>
      </ul>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-sm-12 col-md-4" *ngIf="parcels && parcels.length > 0">
      <div class="card">
        <div class="card-header">
          Water Budget Overview
        </div>
        <div class="card-body">
          <table class="table table-responsive">
            <tbody>
              <tr>
                <td>
                  Total Parcel Area
                </td>
                <td style="text-align: right">
                  {{getTotalAPNAcreage()}}
                </td>
              </tr>
              <tr>
                <td style="white-space: nowrap">
                  Annual Allocation
                </td>
                <td style="text-align: right">
                  <span *ngIf="getAnnualAllocation()">{{getAnnualAllocation() | number: '1.1-1'}} ac-ft</span>
                  <span *ngIf="!getAnnualAllocation()" class="systemText">Not available</span>
                </td>
              </tr>
              <tr>
                <td>
                  Purchased
                </td>
                <td style="text-align: right">
                  <span *ngIf="getPurchasedAcreFeet()">{{getPurchasedAcreFeet() | number: '1.1-1'}} ac-ft</span>
                  <span *ngIf="!getPurchasedAcreFeet()" class="systemText">-</span>
                </td>
              </tr>
              <tr>
                <td>
                  Sold
                </td>
                <td style="text-align: right">
                  <span *ngIf="getSoldAcreFeet()">{{getSoldAcreFeet() | number: '1.1-1'}} ac-ft</span>
                  <span *ngIf="!getSoldAcreFeet()" class="systemText">Not available</span>
                </td>
              </tr>
              <tr>
                <td>
                  Usage to Date
                </td>
                <td style="text-align: right">
                  <span *ngIf="getWaterUsageToDate()">{{getWaterUsageToDate() | number: '1.1-1'}} ac-ft</span>
                  <span *ngIf="!getWaterUsageToDate()" class="systemText">Not available</span>
                </td>
              </tr>
              <tr>
                <td>
                  Projected Need
                </td>
                <td style="text-align: right">
                  <span class="systemText">Not yet implemented</span>
                </td>
              </tr>
              <tr>
                <td>
                  Surplus / Deficit
                </td>
                <td style="text-align: right">
                  <span *ngIf="getEstimatedAvailableSupply()">{{getEstimatedAvailableSupply() | number: '1.1-1'}}
                    ac-ft</span>
                  <span *ngIf="!getEstimatedAvailableSupply()" class="systemText">Not available</span>
                </td>
              </tr>
          </table>

        </div>
      </div>
      <div class="card mt-4">
        <div class="card-header">
          Water Use
        </div>
        <div class="card-body">
          Estimated through {{getLastETReadingDate()}}*
          <table class="table table-responsive table-condensed">
            <thead>
              <tr>
                <th>APN</th>
                <th style="text-align: right; white-space: nowrap;">Water Usage</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let parcel of parcels">
                <td>
                  <a routerLink="/parcels/{{parcel.ParcelID}}">{{parcel.ParcelNumber}}</a>
                </td>
                <td style="text-align: right">
                  <span *ngIf="getWaterConsumption(parcel)">{{getWaterConsumption(parcel) | number: '1.1-1'}}
                    ac-ft</span>
                  <span *ngIf="!getWaterConsumption(parcel)" class="systemText">Not available</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-8" *ngIf="trades">
      <div class="card">
        <div class="card-header">
          Trade Activity
        </div>
        <div class="card-body">
          <p *ngIf="trades.length === 0">You have no trade activity.</p>
          <table class="table table-striped table-responsive" *ngIf="trades.length > 0">
            <thead>
              <tr>
                <th></th>
                <th>Posting Date</th>
                <th>Status</th>
                <th>Quantity</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let trade of trades">
                <td><a class="btn btn-primary btn-sm" routerLink="/trades/{{trade.TradeID}}">View</a></td>
                <td style="white-space: nowrap">{{ trade.OfferDate | date:"short" }}</td>
                <td style="white-space: nowrap">{{ trade.TradeStatus.TradeStatusDisplayName }}</td>
                <td>{{ trade.Quantity }} ac-ft</td>
                <td style="white-space: nowrap">{{ trade.Price | currency: "USD" }} per ac-ft</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card mt-4" *ngIf="parcels && parcels.length > 0">
        <div class="card-header">
          Location
        </div>
        <div class="card-body">
          <parcel-map mapID="parcelsMapForUser" [selectedParcelIDs]="getSelectedParcelIDs()" mapHeight="500px">
          </parcel-map>
        </div>
      </div>
    </div>
  </div>
  <p class="small" *ngIf="parcels && parcels.length > 0">*Estimated water usage is based on satellite imagery and may
    not be accurate at the APN level.</p>
</div>