<nav aria-label="breadcrumb" *ngIf="posting">
  <ol class="breadcrumb">
    <li class="breadcrumb-item" aria-current="page">
      <a routerLink="/trades">Trades</a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">
      Posting: {{posting.PostingType.PostingTypeDisplayName + " " + posting.Quantity}} ac-ft
    </li>
  </ol>
</nav>
<div class="container mt-sm-4" *ngIf="posting">
  <h2 style="display: inline-block">
    Posting: {{posting.PostingType.PostingTypeDisplayName + " " + posting.Quantity}} ac-ft
  </h2>
  <app-alert-display></app-alert-display>
  <div class="row mt-4">
    <div class="col-sm-12 col-md-6">
      <div class="card">
        <div class="card-header">
          <a *ngIf="canEditCurrentPosting()" class="btn btn-primary btn-sm float-right"
            routerLink="/postings/{{posting.PostingID}}/edit">
            <span class="fas fa-edit"></span> Edit
          </a>
          Details
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="text-sm-right col-sm-5 col-xs-12">Posting Date</dt>
            <dd class="col-sm-7 col-xs-12">
              {{posting.PostingDate | date:'short'}}
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Type</dt>
            <dd class="col-sm-7 col-xs-12">
              {{posting.PostingType.PostingTypeDisplayName}}
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Status</dt>
            <dd class="col-sm-7 col-xs-12">
              {{posting.PostingStatus.PostingStatusDisplayName}}
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Quantity</dt>
            <dd class="col-sm-7 col-xs-12">
              {{posting.Quantity}} ac-ft
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Unit Price</dt>
            <dd class="col-sm-7 col-xs-12">
              {{posting.Price | currency: "USD" }} per ac-ft
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Total Price</dt>
            <dd class="col-sm-7 col-xs-12">
              {{getTotalPrice(posting) | currency : "USD" }}
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Description</dt>
            <dd class="col-sm-7 col-xs-12">
              {{posting.PostingDescription}}
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-6">
      <div class="card" *ngIf="isPostingOwner">
        <div class="card-header">
          Your Actions
        </div>
        <div class="card-body" *ngIf="isPostingOpen()">
          <p>This is your posting.  View any offers on your dashboard.</p>
          <div class="text-center">
            <a class="btn btn-primary btn-sm mr-1" routerLink="/landowner-dashboard">View Dashboard</a>
            <button class="btn btn-primary btn-sm" (click)="closePosting()">Close Posting</button>
          </div>
        </div>
        <div class="card-body" *ngIf="!isPostingOpen()">
          <p>Your posting is closed.  No further actions are allowed.</p>
        </div>
      </div>

      <div class="card" *ngIf="isPostingOpen() && !isPostingOwner && !isConfirmingTrade && !isCounterOffering">
        <div class="card-header">
          Your Offer
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="text-sm-right col-sm-5 col-xs-12">Purchase Quantity</dt>
            <dd class="col-sm-7 col-xs-12">
              <span>{{model.Quantity}} ac-ft</span>
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Unit Price</dt>
            <dd class="col-sm-7 col-xs-12">
              <span>{{model.Price | currency: "USD" }} per ac-ft</span>
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Total Price</dt>
            <dd class="col-sm-7 col-xs-12">
              {{getTotalPrice(model) | currency : "USD" }}
            </dd>
          </dl>
          <div class="text-center">
            <button class="btn btn-primary btn-sm mr-1" *ngIf="offers.length == 0"
              (click)="acceptCurrentOffer()">Accept Offer</button>
            <button class="btn btn-primary btn-sm mr-1" (click)="isCounterOffering = true"
              *ngIf="!isPendingOffer()">Make Counter
              Offer</button>
            <button class="btn btn-primary btn-sm" (click)="rescindOffer()" *ngIf="isPendingOffer()">Rescind Offer</button>
          </div>
        </div>
      </div>

      <div class="card" *ngIf="isCounterOffering && !isConfirmingTrade">
        <div class="card-header">
          Your Offer
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="text-sm-right col-sm-5 col-xs-12">{{offerType}} Quantity</dt>
            <dd class="col-sm-7 col-xs-12">
              <div class="input-group">
                <input type="number" class="form-control" name="Quantity" required [(ngModel)]="model.Quantity" />
                <div class="input-group-append">
                  <span class="input-group-text"> ac-ft</span>
                </div>
              </div>
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Unit Price</dt>
            <dd class="col-sm-7 col-xs-12">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">$</span>
                </div>
                <input type="number" class="form-control" name="Price" required [(ngModel)]="model.Price" />
                <div class="input-group-append">
                  <span class="input-group-text"> per ac-ft</span>
                </div>
              </div>
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Total Price</dt>
            <dd class="col-sm-7 col-xs-12">
              {{getTotalPrice(model) | currency : "USD" }}
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Notes</dt>
            <dd class="col-sm-7 col-xs-12">
              <textarea class="form-control" name="OfferNotes" style="height: 200px"
              [(ngModel)]="model.OfferNotes"></textarea>
            </dd>
          </dl>
          <div class="text-center">
            <button class="btn btn-primary btn-sm mr-1" (click)="isConfirmingTrade = true">Present Counter
              Offer</button>
            <button class="btn btn-primary btn-sm" (click)="cancelCounterOffer()">Cancel</button>
          </div>
        </div>
      </div>
      <div class="card" *ngIf="isConfirmingTrade">
        <div class="card-header">
          Confirm Your Trade
        </div>
        <div class="card-body">
          <p *ngIf="!isRescindingTrade && !isRejectingTrade && !isCounterOffering">Please confirm your intent to execute
            this trade
            agreement.<br /><strong>This
              action is final</strong> and
            obligates you to complete the financial transaction according to the quantity and price specified here, and
            will adjust your annual water allocation accordingly.</p>
          <p *ngIf="isRescindingTrade">Please confirm you wish to rescind your current offer.</p>
          <p *ngIf="isRejectingTrade">Please confirm you wish to reject further negotiations. You will no longer be able
            to respond to the current Trade. You can however initiate new trades from the Postings page.</p>
          <p *ngIf="isCounterOffering">Please confirm details of your counter-offer. The counter-offer will be presented
            to the {{counterOfferRecipientType}}, who will have up to 5 days to review your offer.</p>
          <dl class="row">
            <dt class="text-sm-right col-sm-5 col-xs-12">{{offerType}} Quantity</dt>
            <dd class="col-sm-7 col-xs-12">
              <span>{{model.Quantity}} ac-ft</span>
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Unit Price</dt>
            <dd class="col-sm-7 col-xs-12">
              <span>{{model.Price | currency: "USD" }} per ac-ft</span>
            </dd>

            <dt class="text-sm-right col-sm-5 col-xs-12">Total Price</dt>
            <dd class="col-sm-7 col-xs-12">
              {{getTotalPrice(model) | currency : "USD" }}
            </dd>
          </dl>
          <div class="text-center">
            <button class="btn btn-primary btn-sm mr-1" (click)="confirmTrade()" [disabled]="isLoadingSubmit">
              <span *ngIf="isLoadingSubmit" class="fa fa-spinner loading-spinner"></span>
              Confirm
            </button>
            <button class="btn btn-primary btn-sm" (click)="cancelConfirmation()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>