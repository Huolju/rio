<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item" aria-current="page">
            <a routerLink="/landowner-dashboard">Landowner Dashboard</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            Override OpenET Data
        </li>
    </ol>
</nav>
<div class="container mt-sm-4" *ngIf="account">
    <app-alert-display></app-alert-display>
    
    <h2>
        Override ET Data for - {{account.AccountDisplayName}} - {{waterYearToDisplay}}
    </h2>
    <p class="lead">
        This editor is used to override water usage as reported by OpenET. When in edit mode, the top row 
        for each parcel shows the OpenET water usage and the bottom row allows entering an override value. 
        When an override value is provided, all water accounting in the platform uses the override data instead 
        of OpenET data.
    </p>   
    <div class="row">
        <div class="col-md-12 offset-md-10" >
            <rio-water-year-select [years]="waterYears" [(selectedYear)]="waterYearToDisplay"
                (selectedYearChange)="updateAnnualData()" [(disabled)]="isEditing"></rio-water-year-select>
        </div>
    </div>

    <div class="row" *ngIf="parcels && parcels.length > 0">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-header">
                    <div class="float-right">
                        <a class="btn btn-rio btm-sm mr-3" href="/landowner-dashboard" *ngIf="!isEditing">Back to Landowner Dashboard</a> 
                        <button class="btn btn-rio" [(disabled)]="isEditing" (click)="toggleEditMode()">Edit</button>
                    </div>
                    {{waterYearToDisplay}} Water Usage by Parcel
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-condensed">
                            <thead>
                                <tr>
                                    <th>Parcel Number</th>
                                    <th class="text-right" *ngFor="let month of months">{{month}}</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let parcel of parcels">
                                    <td class="text-nowrap"><a routerLink="/parcels/{{parcel.ParcelID}}">{{parcel.ParcelNumber}}</a></td>
                                    <td class="text-right" [ngClass]="parcelMonthlyEvaporation.OverriddenEvapotranspirationRate != null && (!isEditing || checkIfDateColumnIsAFutureDate(parcelMonthlyEvaporation.WaterMonth)) ? 'font-italic' : ''" *ngFor="let parcelMonthlyEvaporation of getParcelEvaporationMonthlyData(parcel)">
                                        <span *ngIf="parcelMonthlyEvaporation.OverriddenEvapotranspirationRate != null && (!isEditing || checkIfDateColumnIsAFutureDate(parcelMonthlyEvaporation.WaterMonth))">*</span>
                                        {{ determineContentsOfCell(parcelMonthlyEvaporation)}} 
                                        <br>
                                        <input type="number" [(ngModel)]="parcelMonthlyEvaporation.OverriddenEvapotranspirationRate" style="width:50px; text-align:right" *ngIf="isEditing && !checkIfDateColumnIsAFutureDate(parcelMonthlyEvaporation.WaterMonth)" (keypress)="catchExtraSymbols($event)" (paste)="catchPastedSymbols($event, parcelMonthlyEvaporation)"></td>
                                    <td class="text-right"><strong>{{getTotalWaterUsageForParcel(parcel) | number:"1.1-1"}}</strong></td>
                                </tr>
                                <tr>
                                    <td><strong>Total</strong></td>
                                    <td class="text-right" *ngFor="let month of months; let i = index"><strong>{{getTotalWaterUsageForMonth(i+1) | number:"1.1-1"}}</strong></td>
                                    <td class="text-right"><strong>{{getTotalWaterUsageForAccount() | number:"1.1-1"}}</strong></td>
                                </tr>
                            </tbody>                            
                        </table>   
                        <p class="small">
                            <em>* Indicates OpenET usage data has been overridden</em>    
                        </p>                 
                    </div>
                    <ng-container *ngIf="isEditing">
                        <button class="btn btn-secondary btn-sm float-right" (click)="cancelOverrideEtChanges()">Cancel</button>
                        <button class="btn btn-rio btn-sm mr-3 float-right" (click)="confirmSaveOverrideEtChanges()">Save</button>
                    </ng-container>                    
                </div>
            </div>
        </div>
    </div>
</div>